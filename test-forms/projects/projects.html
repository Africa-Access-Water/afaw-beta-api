<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Projects</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4 text-primary">All Projects</h2>

    <a href="create-project.html" class="btn btn-primary mb-3">Create New Project</a>

    <table class="table table-striped table-hover shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Category</th>
          <th>Goal</th>
          <th>Raised</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="projectsTable"></tbody>
    </table>
  </div>

  <script>
    async function fetchProjects() {
      try {
        const res = await fetch("http://localhost:5000/api/projects");
        const projects = await res.json();

        const tbody = document.getElementById("projectsTable");
        tbody.innerHTML = "";

        projects.forEach(p => {
          const row = `
            <tr>
              <td>${p.id}</td>
              <td>${p.name}</td>
              <td>${p.category || "-"}</td>
              <td>${p.donation_goal || 0}</td>
              <td>${p.donation_raised || 0}</td>
              <td>
                <a href="edit-project.html?id=${p.id}" class="btn btn-sm btn-warning">Edit</a>
                <button class="btn btn-sm btn-danger" onclick="deleteProject(${p.id})">Delete</button>
              </td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
      } catch (err) {
        console.error(err);
        alert("Error fetching projects");
      }
    }

    async function deleteProject(id) {
      if (!confirm("Are you sure you want to delete this project?")) return;

      try {
        const res = await fetch(`http://localhost:5000/api/projects/${id}`, { method: "DELETE" });
        const json = await res.json();
        alert("Deleted: " + JSON.stringify(json));
        fetchProjects(); // refresh list
      } catch (err) {
        console.error(err);
        alert("Error deleting project");
      }
    }

    fetchProjects();
  </script>
</body>
</html>
